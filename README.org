#+title:     Ectorepo: KDE
#+author:    David Conner
#+email:     noreply@te.xel.io

A collection of KDE resources and repos exposed as a Repo manifest for all your
grep-finding pleasure.

Linux badly needs to distribute sources with distributions/packages and make it
obvious how to find the source -- and not on a project by project basis.

* Intended Usage

This is mostly intended to keep source up to date for reference. to develop
using repo, you need to group the projects that share common build targets with
that in mind. See the android or chromium XML's. it has all the same traps of
git submodules because it's the domain that's complex. it doesn't matter how
that complexity is specified.

Each =invent.kde.org= group should have it's own XML file.

For the =plasma= group of projects, you would:

+ create a containing directory at =$_ECTO/kde=
+ create a subdirectory at =$_ECTO/kde/plasma= and =cd= to it
+ run =repo init -u https://github.com/ectorepo/kde -m plasma.xml=
+ run =repo sync= to bring all repositories up to date
+ cross your fingers and hope no one renamed a branch to =main=

if so, regenerate the XML by tangling the file or fix it manually. Since repo is
async, it doesn't really tell you what project it's failing on in a "linear"
fashion.

That should give you up to date copies of the following =plasma= repositories:

| aura-browser      | kdeplasma-addons | ksystemstats         | oxygen                       | plasma-mobile           | plasma-workspace            |
| bluedevil         | kde-vdg-extras   | kwallet-pam          | oxygen-gtk                   | plasma-nano             | plasma-workspace-wallpapers |
| breeze            | kgamma5          | kwayland-integration | oxygen-sounds                | plasma-nm               | plymouth-kcm                |
| breeze-grub       | kglobalacceld    | kwayland-server      | pico-wizard                  | plasma-pa               | polkit-kde-agent-1          |
| breeze-gtk        | khotkeys         | kwin                 | plank-player                 | plasma-pass             | powerdevil                  |
| breeze-plymouth   | kinfocenter      | kwrited              | plasma5support               | plasma-redshift-control | qqc2-breeze-style           |
| discover          | kmenuedit        | lancelot             | plasma-active-window-control | plasma-sdk              | sddm-kcm                    |
| drkonqi           | kpipewire        | latte-dock           | plasma-bigscreen             | plasma-simplemenu       | smaragd                     |
| flatpak-kcm       | krdp             | layer-shell-qt       | plasma-browser-integration   | plasma-systemmonitor    | systemsettings              |
| kactivitymanagerd | kscreen          | libkscreen           | plasma-desktop               | plasma-tests            | user-manager                |
| kde-cli-tools     | kscreenlocker    | libksysguard         | plasma-disks                 | plasma-thunderbolt      | xdg-desktop-portal-kde      |
| kdecoration       | ksshaskpass      | milou                | plasma-firewall              | plasma-vault            |                             |
| kde-gtk-config    | ksysguard        | ocean-sound-theme    | plasma-integration           | plasma-welcome          |                             |

* Org Babel

#+begin_src emacs-lisp
(setq-local org-confirm-babel-evaluate nil)
#+end_src


#+name: nrepos
#+begin_src emacs-lisp
100
#+end_src

#+RESULTS: nrepos
: 100


* KDE Invent

[[https://invent.kde.org/explore/groups?sort=name_asc][Invent.kde.org]] is the main forge for KDE. It's split into the following groups, which we can pull with their [[https://docs.gitlab.com/ee/api/][Gitlab API]], via org-babel and either restclient or graphql.

Assuming that the presence of Gitlab [[https://invent.kde.org/help/api/graphql/index.md][GraphQL docs]] in [[https://invent.kde.org/help/#build-an-integration-with-gitlab][KDE's integration docs]]
implies that feature is active, that would be far more convenient. Checking the
Gitlab [[https://docs.gitlab.com/ee/api/graphql/index.html][GraphQL docs]] (including the [[https://docs.gitlab.com/ee/api/graphql/getting_started.html][Getting Started]] guide) gives us some more
info.


** Schema

This can run in the GraphiQL explorer

#+begin_src graphql
query {
  __schema {
    types {
      name
      kind
      description
      fields { name }
    }
  }
}
#+end_src


** Groups

#+name: invent-groups-graphql
#+begin_example graphql
query {
  groups(first: 100)  {
    nodes {
      id
      name
      parent {
        id
        name
        path
        fullPath
      }
      description
      path
      fullPath
      projects {
        count
      }
    }
	}
}
#+end_example

Run the query ... wow how tf did i not figure out that it can take a string?!

#+name: invent-groups-eld
#+begin_src emacs-lisp :results silent :var gql=invent-groups-graphql
(ghub-graphql gql nil
              :username "aionfork"
              :host "invent.kde.org"
              :forge 'gitlab)
#+end_src

This should be a =#+call:= or =defun= instead, but this way, I can work with eld
or json.

#+name: invent-groups-json
#+headers: :var eld=invent-groups-eld :file /tmp/invent.groups.json
#+begin_src emacs-lisp :results value file
(json-encode eld)
#+end_src

#+RESULTS: invent-groups-json
[[file:/tmp/invent.groups.json]]

All the text is escaped or it can't be formatted.
+ as TSV: =#+begin_src jq :results output file :file /tmp/invent.groups.tsv=
+ stdin doesn't work too well =#+headers: :stdin invent-groups-json=

#+name invent-groups-tsv
#+headers: :in-file /tmp/invent.groups.json
#+headers: :file /tmp/invent.groups.tsv :cmd-line --raw-output
#+begin_src jq :results value file
.data.groups.nodes[]
  | [.name, .projects.count, .path, .fullPath, .description]
  | @tsv
#+end_src

#+RESULTS:
[[file:/tmp/invent.groups.tsv]]

cat the +tsv+ ... +csv+ ... TSV to a table

#+begin_src sh :results output table
# cat /tmp/invent.groups.tsv
cat /tmp/invent.groups.tsv  #| sed -e 's/\\"//g'
#+end_src

#+RESULTS:
| 3rdparty                         |  18 | 3rdparty              | neon/3rdparty               |                                                                                          |
| Accessibility                    |   1 | accessibility         | teams/accessibility         |                                                                                          |
| Accessibility                    |   4 | accessibility         | accessibility               | Applications aimed at making computing more accessible                                   |
| Akademy                          |   2 | akademy               | teams/akademy               |                                                                                          |
| Android                          |   1 | android               | teams/android               |                                                                                          |
| Automation and Systematization   |   1 | automation            | teams/automation            | Team dedicated to the implementation of the KDE Goal with the same name. See https://community.kde.org/Goals/Automate_and_systematize_internal_processes |
| backports-focal                  |  56 | backports-focal       | neon/backports-focal        |                                                                                          |
| backports-jammy                  |  62 | backports-jammy       | neon/backports-jammy        |                                                                                          |
| Blauer Engel                     |   1 | blauer-engel          | teams/blauer-engel          |                                                                                          |
| CI Artifacts                     |  13 | ci-artifacts          | teams/ci-artifacts          |                                                                                          |
| clang                            |   5 | clang                 | qt/clang                    |                                                                                          |
| Community Working Group          |   1 | community-wg          | teams/community-wg          |                                                                                          |
| Documentation                    |   1 | documentation         | teams/documentation         |                                                                                          |
| Documentation                    |   8 | documentation         | documentation               | Documentation for some of the KDE software                                               |
| Education                        |  34 | education             | education                   | Applications, libraries and add-ons for educational and scientific purposes              |
| extras                           | 122 | extras                | neon/extras                 |                                                                                          |
| Flathub                          |   1 | flathub               | teams/flathub               | Team of KDE developers maintaining the KDE Apps as Flatpaks on Flathub and in KDE Invent.\r\n\r\nIssues with Flathub Flatpaks should be opened on Flathub GitHub repos. |
| Forks                            |  33 | forks                 | neon/forks                  |                                                                                          |
| Frameworks                       |  87 | frameworks            | frameworks                  | KDE Frameworks, cross-platform add-on libraries for coding applications with Qt          |
| Frameworks Devs                  |   1 | frameworks-devs       | teams/frameworks-devs       |                                                                                          |
| Games                            |  48 | games                 | games                       | Applications for fun and entertainment                                                   |
| Gardening                        |   1 | gardening             | teams/gardening             |                                                                                          |
| GCompris Contributors            |   1 | gcompris-contributors | teams/gcompris-contributors |                                                                                          |
| Graphics                         |  42 | graphics              | graphics                    | Applications, libraries and add-ons that display and edit computer graphics              |
| Historical                       |  16 | historical            | historical                  | Repositories that serve a historical purpose                                             |
| infrastructure                   |   3 | infrastructure        | neon/infrastructure         |                                                                                          |
| InfrastructureTests              |   4 | infrastructuretests   | teams/infrastructuretests   |                                                                                          |
| installer-framework              |   1 | installer-framework   | qt/installer-framework      |                                                                                          |
| kde                              | 385 | kde                   | neon/kde                    |                                                                                          |
| KDE Brazil                       |   4 | kde-brazil            | teams/kde-brazil            |                                                                                          |
| KDE Developers                   |   1 | kde-developers        | teams/kde-developers        |                                                                                          |
| KDE Eco                          |   5 | eco                   | teams/eco                   |                                                                                          |
| KDE Espana Board                 |   0 | kde-espana-board      | teams/kde-espana-board      |                                                                                          |
| KDE e.V.                         |   0 | kde-ev                | teams/kde-ev                |                                                                                          |
| KDE e.V. Board                   |   4 | kde-ev-board          | teams/kde-ev-board          |                                                                                          |
| KDE e.V. Financial Working Group |   0 | kde-ev-financial      | teams/kde-ev-financial      |                                                                                          |
| KDE e.V. Fundraising             |   0 | kde-ev-fundraising    | teams/kde-ev-fundraising    |                                                                                          |
| KDE Francophone                  |   1 | kde-francophone       | teams/kde-francophone       |                                                                                          |
| KDE Free Qt Working Group        |   1 | kde-free-qt-wg        | teams/kde-free-qt-wg        |                                                                                          |
| KDE IM Operations                |   1 | kde-im-operations     | teams/kde-im-operations     | Supporting KDE's IRC, Matrix & Telegram channels and users                               |
| KDE Russia                       |   3 | kde-russia            | teams/kde-russia            |                                                                                          |
| KDevelop                         |  15 | kdevelop              | kdevelop                    | Cross-platform IDE for C, C++, Python, QML/JavaScript and PHP                            |
| KDE Visual Design Group          |   1 | vdg                   | teams/vdg                   | KDE's visual and UX/UI design group                                                      |
| KDE Web Team                     |   1 | web                   | teams/web                   |                                                                                          |
| kf6                              |  80 | kf6                   | neon/kf6                    |                                                                                          |
| Libraries                        |  59 | libraries             | libraries                   | Various useful libraries used by other KDE projects                                      |
| license-tools                    |   1 | license-tools         | qt/license-tools            |                                                                                          |
| Licensing                        |   1 | licensing             | teams/licensing             |                                                                                          |
| Localization                     |   0 | localization          | teams/localization          | The KDE project which touches Localization (l10n) and Internationalization (i18n)        |
| Maui                             |  31 | maui                  | maui                        | Modular front-end framework for developing fast and compelling user experiences          |
| meta                             |   1 | meta                  | qt/meta                     |                                                                                          |
| ministro                         |   1 | ministro              | qt/ministro                 |                                                                                          |
| mobile                           |  33 | mobile                | neon/mobile                 |                                                                                          |
| Multimedia                       |  27 | multimedia            | multimedia                  | Applications for multimedia playback, processing and creation                            |
| neon                             |  22 | neon                  | neon/neon                   |                                                                                          |
| Neon                             |   5 | neon                  | neon                        | Packaging information for the Neon distribution                                          |
| neon-packaging                   | 176 | neon-packaging        | neon/neon-packaging         |                                                                                          |
| Network                          |  48 | network               | network                     | Applications and add-ons that interact with Internet and other networks                  |
| Office                           |  14 | office                | office                      | Office applications that work with documents, databases and finances.                    |
| Packaging                        |  22 | packaging             | packaging                   | Data and tools that help deliver KDE software to its users                               |
| PIM                              |   1 | pim                   | teams/pim                   |                                                                                          |
| PIM                              |  74 | pim                   | pim                         | Applications, libraries and add-ons for personal information management                  |
| Plasma                           |  76 | plasma                | plasma                      | Desktop environment for a wide range of devices and user needs                           |
| Plasma Bigscreen                 |  13 | plasma-bigscreen      | plasma-bigscreen            | Open-source user interface for Televisions, based on Plasma technologies                 |
| Plasma Ink                       |   1 | plasma-ink            | teams/plasma-ink            |                                                                                          |
| Plasma Mobile                    |   1 | plasma-mobile         | teams/plasma-mobile         |                                                                                          |
| Plasma Mobile                    |  17 | plasma-mobile         | plasma-mobile               | Open-source user interface for phones, based on Plasma technologies                      |
| playground                       |  15 | playground            | qt/playground               |                                                                                          |
| Promo                            |   0 | promo                 | teams/promo                 |                                                                                          |
| pyside                           |   7 | pyside                | qt/pyside                   |                                                                                          |
| qbs                              |   1 | qbs                   | qt/qbs                      |                                                                                          |
| qt                               |  49 | qt                    | neon/qt                     |                                                                                          |
| qt                               | 104 | qt                    | qt/qt                       |                                                                                          |
| qt3dstudio                       |   7 | qt3dstudio            | qt/qt3dstudio               |                                                                                          |
| qt4ia                            |   1 | qt4ia                 | qt/qt4ia                    |                                                                                          |
| qt6                              |  50 | qt6                   | neon/qt6                    |                                                                                          |
| qt-apps                          |  19 | qt-apps               | qt/qt-apps                  |                                                                                          |
| qt-creator                       |   2 | qt-creator            | qt/playground/qt-creator    |                                                                                          |
| qt-creator                       |  12 | qt-creator            | qt/qt-creator               |                                                                                          |
| qtdesigntools                    |   1 | qtdesigntools         | qt/qtdesigntools            |                                                                                          |
| qt-extensions                    |   4 | qt-extensions         | qt/qt-extensions            |                                                                                          |
| qt-labs                          |  28 | qt-labs               | qt/qt-labs                  |                                                                                          |
| qt-learning                      |   2 | qt-learning           | qt/qt-learning              |                                                                                          |
| qt-mobility                      |   1 | qt-mobility           | qt/qt-mobility              |                                                                                          |
| qtonpi                           |   1 | qtonpi                | qt/qtonpi                   |                                                                                          |
| Qt Project                       |   1 | qt                    | qt                          | Replica of the Qt Project repositories, containing the KDE maintained patch branches in addition to everything from upstream. |
| qtqa                             |   7 | qtqa                  | qt/qtqa                     |                                                                                          |
| qtsdk                            |   2 | qtsdk                 | qt/qtsdk                    |                                                                                          |
| qt-solutions                     |   1 | qt-solutions          | qt/qt-solutions             |                                                                                          |
| Quality Assurance                |   1 | qa                    | teams/qa                    |                                                                                          |
| Release Service                  |   1 | release-service       | teams/release-service       |                                                                                          |
| Rolisteam                        |   8 | rolisteam             | rolisteam                   | Virtual tabletop software that helps manage tabletop role playing games with remote friends/players |
| SDK                              |  42 | sdk                   | sdk                         | Applications and scripts that ease software development                                  |
| Sysadmin                         |  57 | sysadmin              | sysadmin                    | KDE sysadmin team and infrastructure-related repositories                                |
| System                           |  37 | system                | system                      | Programs that interact with lower-level operating system components                      |
| Teams                            |   2 | teams                 | teams                       |                                                                                          |
| test                             |   1 | test                  | qt/test                     |                                                                                          |
| Unmaintained                     | 280 | unmaintained          | unmaintained                | Projects that do not have a maintainer and are not currently active                      |
| Usability                        |   1 | usability             | teams/usability             |                                                                                          |
| Utilities                        |  63 | utilities             | utilities                   | Software utilities for a wide range of tasks, developed by KDE                           |


* Plasma

#+name: invent-plasma-gql
#+begin_example graphql
{
  group(fullPath: "plasma") {
    projects(first: 100, sort: ACTIVITY_DESC) {
      nodes {
        id
        name
        topics
        path
        fullPath
        visibility
        repository {
          rootRef
          exists
        }
      }
    }
  }
}

#+end_example

Run query

#+name: invent-plasma-eld
#+begin_src emacs-lisp :var gql=invent-plasma-gql
(ghub-graphql gql nil
              :username "aionfork"
              :host "invent.kde.org"
              :forge 'gitlab)
#+end_src

fdsafdsa the output (the macros make this hard to turn into a function)

#+name: invent-plasma-xml
#+headers: :var gqldata=invent-plasma-eld :results value html
#+begin_src emacs-lisp
(thread-first
  (thread-last
    (a-get* (nthcdr 0 gqldata) 'data 'group 'projects 'nodes)
    ;(mapcar (lambda (el) (a-get* el 'node)))
    ;(seq-filter (lambda (el) (not (a-get* el 'isArchived))))
    (mapcar (lambda (el)
              (let* (;; (defaultBranchRef (a-get* 'defaultBranchRef))
                     (path (a-get* el 'path))
                     (name (a-get* el 'fullPath))
                     (root-ref (a-get* el 'repository 'rootRef))
                     (ref (concat "refs/heads/" root-ref)))
                (concat "<project"
                        " name=\"" name
                        "\" path=\"" path
                        "\" revision=\"" ref "\" remote=\"invent\"/>")))))
  (cl-sort 'string-lessp :key 'downcase)
  (string-join "\n"))
#+end_src

#+RESULTS: invent-plasma-xml
#+begin_export html
<project name="plasma/aura-browser" path="aura-browser" revision="refs/heads/master" remote="invent"/>
<project name="plasma/bluedevil" path="bluedevil" revision="refs/heads/master" remote="invent"/>
<project name="plasma/breeze" path="breeze" revision="refs/heads/master" remote="invent"/>
<project name="plasma/breeze-grub" path="breeze-grub" revision="refs/heads/master" remote="invent"/>
<project name="plasma/breeze-gtk" path="breeze-gtk" revision="refs/heads/master" remote="invent"/>
<project name="plasma/breeze-plymouth" path="breeze-plymouth" revision="refs/heads/master" remote="invent"/>
<project name="plasma/discover" path="discover" revision="refs/heads/master" remote="invent"/>
<project name="plasma/drkonqi" path="drkonqi" revision="refs/heads/master" remote="invent"/>
<project name="plasma/flatpak-kcm" path="flatpak-kcm" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kactivitymanagerd" path="kactivitymanagerd" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kde-cli-tools" path="kde-cli-tools" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kde-gtk-config" path="kde-gtk-config" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kde-vdg-extras" path="kde-vdg-extras" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kdecoration" path="kdecoration" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kdeplasma-addons" path="kdeplasma-addons" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kgamma5" path="kgamma5" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kglobalacceld" path="kglobalacceld" revision="refs/heads/master" remote="invent"/>
<project name="plasma/khotkeys" path="khotkeys" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kinfocenter" path="kinfocenter" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kmenuedit" path="kmenuedit" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kpipewire" path="kpipewire" revision="refs/heads/master" remote="invent"/>
<project name="plasma/krdp" path="krdp" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kscreen" path="kscreen" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kscreenlocker" path="kscreenlocker" revision="refs/heads/master" remote="invent"/>
<project name="plasma/ksshaskpass" path="ksshaskpass" revision="refs/heads/master" remote="invent"/>
<project name="plasma/ksysguard" path="ksysguard" revision="refs/heads/master" remote="invent"/>
<project name="plasma/ksystemstats" path="ksystemstats" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kwallet-pam" path="kwallet-pam" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kwayland-integration" path="kwayland-integration" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kwayland-server" path="kwayland-server" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kwin" path="kwin" revision="refs/heads/master" remote="invent"/>
<project name="plasma/kwrited" path="kwrited" revision="refs/heads/master" remote="invent"/>
<project name="plasma/lancelot" path="lancelot" revision="refs/heads/master" remote="invent"/>
<project name="plasma/latte-dock" path="latte-dock" revision="refs/heads/master" remote="invent"/>
<project name="plasma/layer-shell-qt" path="layer-shell-qt" revision="refs/heads/master" remote="invent"/>
<project name="plasma/libkscreen" path="libkscreen" revision="refs/heads/master" remote="invent"/>
<project name="plasma/libksysguard" path="libksysguard" revision="refs/heads/master" remote="invent"/>
<project name="plasma/milou" path="milou" revision="refs/heads/master" remote="invent"/>
<project name="plasma/ocean-sound-theme" path="ocean-sound-theme" revision="refs/heads/master" remote="invent"/>
<project name="plasma/oxygen" path="oxygen" revision="refs/heads/master" remote="invent"/>
<project name="plasma/oxygen-gtk" path="oxygen-gtk" revision="refs/heads/master" remote="invent"/>
<project name="plasma/oxygen-sounds" path="oxygen-sounds" revision="refs/heads/master" remote="invent"/>
<project name="plasma/pico-wizard" path="pico-wizard" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plank-player" path="plank-player" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-active-window-control" path="plasma-active-window-control" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-bigscreen" path="plasma-bigscreen" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-browser-integration" path="plasma-browser-integration" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-desktop" path="plasma-desktop" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-disks" path="plasma-disks" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-firewall" path="plasma-firewall" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-integration" path="plasma-integration" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-mobile" path="plasma-mobile" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-nano" path="plasma-nano" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-nm" path="plasma-nm" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-pa" path="plasma-pa" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-pass" path="plasma-pass" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-redshift-control" path="plasma-redshift-control" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-sdk" path="plasma-sdk" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-simplemenu" path="plasma-simplemenu" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-systemmonitor" path="plasma-systemmonitor" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-tests" path="plasma-tests" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-thunderbolt" path="plasma-thunderbolt" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-vault" path="plasma-vault" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-welcome" path="plasma-welcome" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-workspace" path="plasma-workspace" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma-workspace-wallpapers" path="plasma-workspace-wallpapers" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plasma5support" path="plasma5support" revision="refs/heads/master" remote="invent"/>
<project name="plasma/plymouth-kcm" path="plymouth-kcm" revision="refs/heads/master" remote="invent"/>
<project name="plasma/polkit-kde-agent-1" path="polkit-kde-agent-1" revision="refs/heads/master" remote="invent"/>
<project name="plasma/powerdevil" path="powerdevil" revision="refs/heads/master" remote="invent"/>
<project name="plasma/qqc2-breeze-style" path="qqc2-breeze-style" revision="refs/heads/master" remote="invent"/>
<project name="plasma/sddm-kcm" path="sddm-kcm" revision="refs/heads/master" remote="invent"/>
<project name="plasma/smaragd" path="smaragd" revision="refs/heads/master" remote="invent"/>
<project name="plasma/systemsettings" path="systemsettings" revision="refs/heads/master" remote="invent"/>
<project name="plasma/user-manager" path="user-manager" revision="refs/heads/master" remote="invent"/>
<project name="plasma/xdg-desktop-portal-kde" path="xdg-desktop-portal-kde" revision="refs/heads/master" remote="invent"/>
#+end_export

Generate =plasma.xml= manifest

#+begin_src xml :tangle plasma.xml :noweb yes
<?xml version="1.0" encoding="utf-8"?>
<manifest>
  <include name="_remotes.xml"/>
  <default remote="invent" sync-j="8" revision="refs/heads/master"/>
  <<invent-plasma-xml()>>
</manifest>
#+end_src


* Testing

** Groups
#  | @text \(.name) \(.projects.count) \(.path) \(.fullPath) \(.description)
#  | map({name, projects.count, path, fullPath, description})

#+name: eg-json
#+begin_example json
{
  "data" : {
    "groups" : {
      "nodes" : [ {
        "id" : "gid://gitlab/Group/2684",
        "name" : "3rdparty",
        "parent" : {
          "id" : "gid://gitlab/Group/2647",
          "name" : "Neon",
          "path" : "neon",
          "fullPath" : "neon"
        },
        "description" : "",
        "path" : "3rdparty",
        "fullPath" : "neon/3rdparty",
        "projects" : {"count" : 18}
      } ]
    }
  }
}
#+end_example

#+headers: :stdin eg-json
#+begin_src jq :results output
.data.groups.nodes[]
  | [.name, .projects.count, .path, .fullPath, .description]
  | @tsv
#+end_src

** Projects

#+name: eg-proj
#+begin_example json
{
  "data" : {
    "group" : {
      "projects" : {
        "nodes" : [
          {
            "id" : "gid://gitlab/Project/2703",
            "name" : "Plasma Workspace",
            "topics" : [],
            "path" : "plasma-workspace",
            "fullPath" : "plasma/plasma-workspace",
            "visibility" : "public",
            "repository" : {"rootRef" : "master", "exists" : true}
          },
          {
            "id" : "gid://gitlab/Project/2163",
            "name" : "KDE Portal for XDG Desktop",
            "topics" : [],
            "path" : "xdg-desktop-portal-kde",
            "fullPath" : "plasma/xdg-desktop-portal-kde",
            "visibility" : "public",
            "repository" : {"rootRef" : "master", "exists" : true}
          },
          {
            "id" : "gid://gitlab/Project/2559",
            "name" : "PowerDevil",
            "topics" : [],
            "path" : "powerdevil",
            "fullPath" : "plasma/powerdevil",
            "visibility" : "public",
            "repository" : {"rootRef" : "master", "exists" : true}
          }
        ]
      }
    }
  }
}
#+end_example

#+name: jq-proj
#+headers: :stdin eg-proj
#+headers: :cmd-line --raw-output
#+begin_src jq :results output
.data.group.projects.nodes[]
  | [.name, .path, .fullPath, .description, .repository.rootRef]
#  | @tsv
#+end_src

#+RESULTS:
: Plasma Workspace	plasma-workspace	plasma/plasma-workspace		master
: KDE Portal for XDG Desktop	xdg-desktop-portal-kde	plasma/xdg-desktop-portal-kde		master
: PowerDevil	powerdevil	plasma/powerdevil		master

gadmait... it doesn't understand json?

#+headers: :var json=eg-proj
#+begin_src sh :results output
echo $json | xq -x '.data.group.projects.nodes[] | [.name, .path, .fullPath, .description, .repository.rootRef]'
#+end_src

#+RESULTS:
: xq: Error running jq: ExpatError: not well-formed (invalid token): line 1, column 0.
: [ Babel evaluation exited with code 1 ]
